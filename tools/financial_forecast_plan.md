# 財政予測シミュレーション 実装計画

**記録日**: 2026年2月21日  
**目的**: 財政見通しの「見える化」— 過去7年の実績を30年先まで延長し、会費改定シナリオ別の予測グラフを作成する  
**実装先**: `tools/financial_visualization.ipynb`（新規セクションとして追加）

---

## 1. 必要な入力パラメータ（要確認）

### ① 会費改定シナリオ ★最重要

**現状の会費構造**:
- 月額 300円/世帯
  - 一般会計分: 250円/月 → 年 3,000円/世帯
  - 特別会計分: 50円/月  → 年 600円/世帯（集会所積立）

**冬のアンケート3案を使用（年額ベース）**:

| シナリオ | 年額 | 月額換算 | 備考 |
|----------|-----:|--------:|------|
| A: 現状維持 | 3,600円 | 300円 | 現行のまま |
| B: 簡易化重視 | 3,000円 | 250円 | 現状より **-600円/年** 減額 |
| C: 多様化許容 | 3,600 / 1,200 / 6,000円 | — | 世帯種別で異なる |

**シナリオCの区分と世帯比率（パラメータ化・デフォルト値設定済み）**:

| 区分 | 年額 | デフォルト比率 | 備考 |
|------|-----:|----------:|------|
| 普通会員 | 3,600円 | **50%** | 標準世帯 |
| 優遇会員 | 1,200円 | **40%** | 高齢単身・低利用等 |
| 賛助会員 | 6,000円 | **10%** | 法人・企業等 |

- 比率の合計は常に100%になるようにバリデーションする
- ウィジェットのスライダーで比率を動的に変更可能にする

**改定開始年度**: **2027年**（スライダーで変更可能）

### ② 世帯数の見通し

**過去実績**: 111〜114世帯  
**確認事項**:
- 安定（約110世帯で横ばい）？
- 微減（毎年1世帯ずつ減）？
- 微増（新規入居あり）？

### ③ つくば市からの委託料

**過去実績**: 約250,000円/年（世帯数に応じて変動）  
**確認事項**: 現行水準継続か、将来変化する前提か？

### ④ 年間運営支出（ランニングコスト）

**過去実績（実質支出）**: 170,000〜350,000円/年（平均 約250,000円）  
**確認事項**:
- 現状維持で固定するか？
- インフレ率（年+ ?%）を乗せるか？

### ⑤ 集会所の大規模修繕計画 ★最大の不確定要素

**特別会計現在残高（2024年末）**: 3,609,165円  
**毎年の積立**: 約65,000〜75,000円（通常）＋ 100万円/年（2023・2024年度の加算分）  
**想定値（決定）**:
- 修繕時期: **2045年**
- 第二自治会負担分: **1,000万円**
- 修繕後の加算積立（100万円/年）: 継続するかどうかは後で設定

**補足**: 修繕時期・費用はスライダーで変更可能にする（感度分析のため）

---

## 2. 技術的実装構成

### セル構成（追加する新セクション）

```
セル A: [Markdown] セクション見出し「9. 財政予測シミュレーション」

セル B: [Python] パラメータ定義
  - BASE_YEAR = 2024
  - FORECAST_YEARS = 30
  - 世帯数の年次推移リスト
  - 委託料の単価設定
  - ランニングコスト設定（インフレ率含む）
  - 修繕イベント辞書 {年: 費用}
  - scenarios = [
      {"name": "A: 現状維持",   "年額": 3600, "color": "gray"},
      {"name": "B: 簡易化重視", "年額": 3000, "color": "steelblue"},
      {"name": "C: 多様化許容", "年額": None,  "color": "green",
       "内訳": {"標準": 3600, "軽減": 1200, "法人": 6000},
       "比率": {"普通": 0.50, "優遇": 0.40, "賛助": 0.10}},
    ]
  - REFORM_YEAR = 2027  # 改定開始年度
  - REPAIR_YEAR = 2045
  - REPAIR_COST = 10_000_000  # 1,000万円（第二自治会負担分）

セル C: [Python] シミュレーション関数
  def simulate_forecast(scenario, households, commission, running_cost_base,
                        inflation_rate, repair_events, n_years):
      for year in range(BASE_YEAR+1, BASE_YEAR+n_years+1):
          収入 = 会費×世帯数 + 委託料
          支出 = ランニングコスト × (1+インフレ率)^経過年 + 修繕費（該当年のみ）
          繰越 = 前年繰越 + 収入 - 支出
      return DataFrame(結果)

セル D: [Python] 予測グラフ描画
  - 過去実績（2018〜2024）: 実線
  - 将来予測（2025〜2054）: シナリオ別点線・色分け
  - 修繕費発生年にマーカー（▼）
  - 資産ゼロ ラインに赤の破線

セル E: [Python] インタラクティブウィジェット
  共通パラメータ:
  - 世帯数合計スライダー（80〜130世帯）
  - 改定開始年スライダー（2026〜2035年、デフォルト2027）
  - 修繕費スライダー（100万〜2000万円、デフォルト1000万）
  - 修繕年スライダー（2030〜2055年、デフォルト2045）
  - 加算積立継続チェックボックス
  シナリオC専用:
  - 普通会員比率スライダー（0〜100%）
  - 優遇会員比率スライダー（0〜100%）
  ※ 賛助会員比率 = 100% - 普通 - 優遇（自動計算・表示）
  → すべてのウィジェット変更でグラフをリアルタイム更新
```

### コアロジック（擬似コード）

```python
def simulate(年額_標準, 年額_軽減, 年額_法人,
             世帯数_標準, 世帯数_軽減, 世帯数_法人,
             委託料, 実質支出_基準, インフレ率,
             修繕年, 修繕費, 加算積立, 改定開始年):
    results = []
    資産 = 6_325_986  # 2024年度末 実績総資産
    for year in range(2025, 2055):
        # 収入（改定開始年以降は新年額を適用）
        適用年額_標準 = 年額_標準 if year >= 改定開始年 else 3600
        会費収入 = (適用年額_標準 * 世帯数_標準
                   + 年額_軽減 * 世帯数_軽減
                   + 年額_法人 * 世帯数_法人)
        収入計 = 会費収入 + 委託料
        # 支出
        経過 = year - 2024
        実質支出 = 実質支出_基準 * (1 + インフレ率) ** 経過
        修繕 = 修繕費 if year == 修繕年 else 0
        支出計 = 実質支出 + 修繕
        # 繰越
        資産 += (収入計 - 支出計)
        results.append({"year": year, "資産": 資産, ...})
    return pd.DataFrame(results)
```

---

## 3. 確認待ちアクション

- [x] ① 会費改定シナリオの候補金額 → **アンケート3案を使用（A/B/C）**
- [x] ① 補足: シナリオCの世帯比率 → **普通50% / 優遇40% / 賛助10%（パラメータ化）**
- [x] ① 補足: 改定開始年度 → **2027年（スライダーで変更可）**
- [ ] ② 世帯数の将来見通し（横ばい / 微減 / 微増）
- [ ] ③ 委託料の将来想定（現行維持 / 廃止リスク等）
- [ ] ④ 支出のインフレ率見込み（0% / 1% / 2% 等）
- [x] ⑤ 集会所修繕 → **2045年、第二自治会負担 1,000万円**
- [ ] ⑤ 補足: 修繕後の100万円/年加算積立を継続するか

上記が揃い次第、セル B〜E を notebook に追加する。

---

## 4. 参照データ（実装時の初期値）

```
# 2024年度末 実績
一般会計繰越:  2,716,821円
特別会計繰越:  3,609,165円
総資産:        6,325,986円

# 過去平均値（参考）
年間収入合計:  約580,000〜640,000円
実質支出:      約170,000〜350,000円（平均 約250,000円）
年間純増（実績平均）: 約315,000円/年
```
